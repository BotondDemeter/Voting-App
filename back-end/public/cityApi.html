<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>City API</title>
  <link rel="stylesheet" href="index.css">
  <script type="module" src="./baseUrl.js"></script>
</head>

<body>


  <div class="tab-bar">
    <a style="color: #4CAF50;">City API</a>

    <a href="#" class="tab-link active" data-target="citiesSection">Get All Cities</a>
    <a href="#" class="tab-link" data-target="insertCitySection">Insert a New City</a>
    <a href="#" class="tab-link" data-target="getCityByCountyNameSection">Get City by County Name</a>
    <a href="index.html">Back</a>
  </div>

  <div id="citiesSection" class="form-container active-section">
    <h2>Get All Cities</h2>
    <p>Enpoint</p>
    <code><a href="http://localhost:3000/api/getCities" target="_blank">http://localhost:3000/api/getCities</a></code>
    <button onclick="fetchAllCities()">Get All Cities</button>
    <div id="cities" class="city-list">Cities will be displayed here.</div>
  </div>

  <div id="insertCitySection" class="form-container">
    <h2>Insert a New City</h2>
    <p>Endpoint</p>
    <code>http://localhost:3000/api/insertCity</code>

    <label for="cityName">City Name:</label>
    <input type="text" id="cityName" placeholder="Enter city name">
    <button onclick="insertCity()">Insert City</button>
  </div>

  <div id="getCityByCountyNameSection" class="form-container">
    <h2>Get City by County Name</h2>
    <p>Endpoint</p>
    <code>http://localhost:3000/api/getCityByCountyName/:countyName</code>

    <label for="countyNameSearch">County Name:</label>
    <input type="text" id="countyNameSearch" placeholder="Enter county name" required>
    <button onclick="fetchCityByCountyName()">Fetch Cities</button>

    <div id="cityByCountyResponse" class="city-list">Cities will be displayed here.</div>
  </div>

  <div id="response"></div>

  <script >

    const baseUrl = 'http://192.168.0.74:3000';

    function navigateTo(page) {
      window.location.href = page;
    }

    const tabLinks = document.querySelectorAll('.tab-link');
    tabLinks.forEach(link => {
      link.addEventListener('click', (event) => {
        event.preventDefault();

        tabLinks.forEach(tab => tab.classList.remove('active'));
        event.target.classList.add('active');

        document.querySelectorAll('.form-container').forEach(section => section.classList.remove('active-section'));
        const targetSection = document.getElementById(event.target.dataset.target);
        targetSection.classList.add('active-section');
      });
    });

    async function fetchAllCities() {
      try {
        const response = await fetch(`${baseUrl}/api/getCities`);
        const cities = await response.json();
        const citiesContainer = document.getElementById('cities');
        citiesContainer.innerHTML = cities.length
          ? cities.map(city => `<p>${city.name}</p>`).join('')
          : 'No cities found.';
      } catch (error) {
        console.error('Error fetching cities:', error);
        document.getElementById('cities').textContent = 'Error fetching cities.';
      }
    }

    async function insertCity() {
      const cityName = document.getElementById('cityName').value;
      if (!cityName) {
        alert('Please enter a city name.');
        return;
      }

      try {
        const response = await fetch(`${baseUrl}/api/insertCity`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name: cityName })
        });
        const result = await response.json();
        document.getElementById('response').textContent = `Inserted: ${JSON.stringify(result)}`;
        fetchAllCities();
      } catch (error) {
        console.error('Error inserting city:', error);
        document.getElementById('response').textContent = 'Error inserting city.';
      }
    }

    async function fetchCityByCountyName() {
      const countyName = document.getElementById('countyNameSearch').value.trim();
      if (!countyName) {
        alert('Please enter a county name.');
        return;
      }

      try {
        const response = await fetch(`${baseUrl}/api/getCityByCountyName/${countyName}`);
        const cities = await response.json();
        const cityByCountyContainer = document.getElementById('cityByCountyResponse');
        cityByCountyContainer.innerHTML = cities.length
          ? cities.map(city => `<p>${city.name}</p>`).join('')
          : 'No cities found for this county.';
      } catch (error) {
        console.error('Error fetching cities by county name:', error);
        document.getElementById('cityByCountyResponse').textContent = 'Error fetching cities.';
      }
    }
  </script>
</body>

</html>