<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voting App</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f7fa;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .button {
      display: inline-block;
      padding: 10px 20px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      text-align: center;
      transition: background-color 0.3s;
    }
    .button:hover {
      background-color: #0056b3;
    }
    #votingForm {
      display: none;
      background-color: #fff;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }
    label, input, select, textarea, button {
      font-size: 16px;
      width: 100%;
      margin: 5px 0;
    }
    #votingsList {
      margin-top: 20px;
    }
    .voting-card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .voting-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .voting-description {
      font-size: 16px;
      color: #555;
      margin-bottom: 15px;
    }
    .candidate-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .candidate-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-top: 1px solid #ddd;
    }
    .candidate-item:first-child {
      border-top: none;
    }
    .candidate-name {
      font-weight: bold;
      color: #333;
    }
    .candidate-description {
      font-size: 14px;
      color: #777;
      margin-top: 3px;
    }
    .candidate-votes {
      font-size: 16px;
      color: #333;
      margin-left: 10px;
    }
    .vote-button {
      display: block;
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 5px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      margin-top: 15px;
      transition: background-color 0.3s;
    }
    .vote-button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Voting App</h1>
    <button id="createVotingBtn" class="button">Create Voting</button>
    <button id="showAllVotingsBtn" class="button">Show All Votings</button>

    <!-- Voting Form -->
    <div id="votingForm">
      <h2>Create New Voting</h2>
      <label>Name:</label>
      <input type="text" id="votingName" required><br><br>
      <label>Description:</label>
      <textarea id="votingDescription"></textarea><br><br>
      <label>Region:</label>
      <select id="votingRegion" required>
        <option value="City">City</option>
        <option value="Country">Country</option>
      </select><br><br>
      <label>Region Name:</label>
      <input type="text" id="regionName" required><br><br>
      <label>Start Date:</label>
      <input type="date" id="startDate" required><br><br>
      <label>End Date:</label>
      <input type="date" id="endDate" required><br><br>

      <h3>Candidates</h3>
      <div id="candidatesContainer"></div>
      <button type="button" id="addCandidateBtn" class="button">+ Add Candidate</button><br><br>

      <button id="submitVotingBtn" class="button">Submit Voting</button>
    </div>

    <!-- Votings List -->
    <div id="votingsList">
      <h2>Active Votings</h2>
      <div id="votings"></div>
    </div>
  </div>

  <script>
    document.getElementById('createVotingBtn').addEventListener('click', () => {
      document.getElementById('votingForm').style.display = 'block';
      document.getElementById('votingsList').style.display = 'none';
    });

    document.getElementById('showAllVotingsBtn').addEventListener('click', async () => {
      document.getElementById('votingForm').style.display = 'none';
      document.getElementById('votingsList').style.display = 'block';

      const response = await fetch('/api/votings/active');
      const data = await response.json();

      const votingsContainer = document.getElementById('votings');
      votingsContainer.innerHTML = '';

      data.data.forEach(voting => {
        const votingCard = document.createElement('div');
        votingCard.className = 'voting-card';

        const votingTitle = document.createElement('div');
        votingTitle.className = 'voting-title';
        votingTitle.textContent = voting.name;

        const votingDescription = document.createElement('div');
        votingDescription.className = 'voting-description';
        votingDescription.textContent = voting.description;

        const candidatesList = document.createElement('ul');
        candidatesList.className = 'candidate-list';

        voting.candidates.forEach(candidate => {
          const candidateItem = document.createElement('li');
          candidateItem.className = 'candidate-item';

          const candidateInfo = document.createElement('div');
          const candidateName = document.createElement('span');
          candidateName.className = 'candidate-name';
          candidateName.textContent = candidate.name;

          const candidateDescription = document.createElement('div');
          candidateDescription.className = 'candidate-description';
          candidateDescription.textContent = candidate.description;

          const candidateVotes = document.createElement('span');
          candidateVotes.className = 'candidate-votes';
          candidateVotes.textContent = `Votes: ${candidate.votes}`;

          candidateInfo.appendChild(candidateName);
          candidateInfo.appendChild(candidateDescription);

          candidateItem.appendChild(candidateInfo);
          candidateItem.appendChild(candidateVotes);
          candidatesList.appendChild(candidateItem);
        });

        const voteButton = document.createElement('button');
        voteButton.className = 'vote-button';
        voteButton.textContent = 'Vote';

        const setInactiveButton = document.createElement('button');
        setInactiveButton.className = 'button';
        setInactiveButton.style.backgroundColor = '#dc3545';
        setInactiveButton.textContent = 'Set Inactive';
        setInactiveButton.addEventListener('click', async () => {
          try {
            const response = await fetch(`/api/votings/inactive/${voting._id}`, { method: 'PATCH' });
            if (response.ok) {
              alert('Voting set to inactive');
              document.getElementById('showAllVotingsBtn').click();
            } else {
              alert('Failed to set voting inactive');
            }
          } catch (error) {
            console.error('Error setting voting to inactive:', error);
          }
        });

        votingCard.appendChild(votingTitle);
        votingCard.appendChild(votingDescription);
        votingCard.appendChild(candidatesList);
        votingCard.appendChild(voteButton);
        votingCard.appendChild(setInactiveButton);
        votingsContainer.appendChild(votingCard);
      });
    });

    document.getElementById('addCandidateBtn').addEventListener('click', () => {
      const candidatesContainer = document.getElementById('candidatesContainer');
      const candidateDiv = document.createElement('div');
      candidateDiv.className = 'candidate';

      candidateDiv.innerHTML = `
        <label>Candidate Name:</label>
        <input type="text" class="candidateName" required><br><br>
        <label>Description:</label>
        <textarea class="candidateDescription"></textarea><br><br>
        <label>Party:</label>
        <input type="text" class="candidateParty"><br><br>
        <label>Votes:</label>
        <input type="number" class="candidateVotes" value="0" min="0" required><br><br>
      `;
      candidatesContainer.appendChild(candidateDiv);
    });

    document.getElementById('submitVotingBtn').addEventListener('click', async () => {
      const candidates = [];
      document.querySelectorAll('.candidate').forEach(candidateDiv => {
        const name = candidateDiv.querySelector('.candidateName').value;
        const description = candidateDiv.querySelector('.candidateDescription').value;
        const party = candidateDiv.querySelector('.candidateParty').value || null;
        const votes = parseInt(candidateDiv.querySelector('.candidateVotes').value, 10);

        if (name) {
          candidates.push({ name, description, party, votes });
        }
      });

      const votingData = {
        name: document.getElementById('votingName').value,
        description: document.getElementById('votingDescription').value,
        isActive: true,
        region: document.getElementById('votingRegion').value,
        regionName: document.getElementById('regionName').value,
        startDate: new Date(document.getElementById('startDate').value),
        endDate: new Date(document.getElementById('endDate').value),
        candidates
      };

      const response = await fetch('/api/votings/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(votingData)
      });

      if (response.ok) {
        alert('Voting created successfully');
        document.getElementById('votingForm').style.display = 'none';
        document.getElementById('showAllVotingsBtn').click();
      } else {
        alert('Failed to create voting');
      }
    });
  </script>
</body>
</html>